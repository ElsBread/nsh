<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<header class="ant-layout-header css-1vjf2v5" style="position:fixed;z-index:999;width:100%;display:flex;align-items:center"><div class="logo" style="color:white;font-size:18px;margin-right:24px;font-weight:bold">帮战数据分析平台</div><ul class="ant-menu-overflow ant-menu ant-menu-root ant-menu-horizontal ant-menu-dark css-1vjf2v5" style="flex:1;min-width:0" role="menu" tabindex="0" data-menu-list="true"><li class="ant-menu-overflow-item ant-menu-item" style="opacity:1;order:0" role="menuitem" tabindex="-1" aria-describedby="_R_bcpb_" data-menu-id="rc-menu-uuid-71760-1-/"><span role="img" aria-label="home" class="anticon anticon-home ant-menu-item-icon"><svg viewBox="64 64 896 896" focusable="false" data-icon="home" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M946.5 505L560.1 118.8l-25.9-25.9a31.5 31.5 0 00-44.4 0L77.5 505a63.9 63.9 0 00-18.8 46c.4 35.2 29.7 63.3 64.9 63.3h42.5V940h691.8V614.3h43.4c17.1 0 33.2-6.7 45.3-18.8a63.6 63.6 0 0018.7-45.3c0-17-6.7-33.1-18.8-45.2zM568 868H456V664h112v204zm217.9-325.7V868H632V640c0-22.1-17.9-40-40-40H432c-22.1 0-40 17.9-40 40v228H238.1V542.3h-96l370-369.7 23.1 23.1L882 542.3h-96.1z"></path></svg></span><span class="ant-menu-title-content">首页</span></li><li class="ant-menu-overflow-item ant-menu-item" style="opacity:1;order:1" role="menuitem" tabindex="-1" aria-describedby="_R_jcpb_" data-menu-id="rc-menu-uuid-71760-1-/import"><span role="img" aria-label="upload" class="anticon anticon-upload ant-menu-item-icon"><svg viewBox="64 64 896 896" focusable="false" data-icon="upload" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"></path></svg></span><span class="ant-menu-title-content">数据导入</span></li><li class="ant-menu-overflow-item ant-menu-item" style="opacity: 1; order: 2;" role="menuitem" tabindex="-1" aria-describedby="_R_rcpb_" data-menu-id="rc-menu-uuid-71760-1-/team"><span role="img" aria-label="team" class="anticon anticon-team ant-menu-item-icon"><svg viewBox="64 64 896 896" focusable="false" data-icon="team" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M824.2 699.9a301.55 301.55 0 00-86.4-60.4C783.1 602.8 812 546.8 812 484c0-110.8-92.4-201.7-203.2-200-109.1 1.7-197 90.6-197 200 0 62.8 29 118.8 74.2 155.5a300.95 300.95 0 00-86.4 60.4C345 754.6 314 826.8 312 903.8a8 8 0 008 8.2h56c4.3 0 7.9-3.4 8-7.7 1.9-58 25.4-112.3 66.7-153.5A226.62 226.62 0 01612 684c60.9 0 118.2 23.7 161.3 66.8C814.5 792 838 846.3 840 904.3c.1 4.3 3.7 7.7 8 7.7h56a8 8 0 008-8.2c-2-77-33-149.2-87.8-203.9zM612 612c-34.2 0-66.4-13.3-90.5-37.5a126.86 126.86 0 01-37.5-91.8c.3-32.8 13.4-64.5 36.3-88 24-24.6 56.1-38.3 90.4-38.7 33.9-.3 66.8 12.9 91 36.6 24.8 24.3 38.4 56.8 38.4 91.4 0 34.2-13.3 66.3-37.5 90.5A127.3 127.3 0 01612 612zM361.5 510.4c-.9-8.7-1.4-17.5-1.4-26.4 0-15.9 1.5-31.4 4.3-46.5.7-3.6-1.2-7.3-4.5-8.8-13.6-6.1-26.1-14.5-36.9-25.1a127.54 127.54 0 01-38.7-95.4c.9-32.1 13.8-62.6 36.3-85.6 24.7-25.3 57.9-39.1 93.2-38.7 31.9.3 62.7 12.6 86 34.4 7.9 7.4 14.7 15.6 20.4 24.4 2 3.1 5.9 4.4 9.3 3.2 17.6-6.1 36.2-10.4 55.3-12.4 5.6-.6 8.8-6.6 6.3-11.6-32.5-64.3-98.9-108.7-175.7-109.9-110.9-1.7-203.3 89.2-203.3 199.9 0 62.8 28.9 118.8 74.2 155.5-31.8 14.7-61.1 35-86.5 60.4-54.8 54.7-85.8 126.9-87.8 204a8 8 0 008 8.2h56.1c4.3 0 7.9-3.4 8-7.7 1.9-58 25.4-112.3 66.7-153.5 29.4-29.4 65.4-49.8 104.7-59.7 3.9-1 6.5-4.7 6-8.7z"></path></svg></span><span class="ant-menu-title-content">团队分配</span></li><li class="ant-menu-overflow-item ant-menu-item" style="opacity: 1; order: 3;" role="menuitem" tabindex="-1" aria-describedby="_R_13cpb_" data-menu-id="rc-menu-uuid-71760-1-/analysis"><span role="img" aria-label="bar-chart" class="anticon anticon-bar-chart ant-menu-item-icon"><svg viewBox="64 64 896 896" focusable="false" data-icon="bar-chart" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm-600-80h56c4.4 0 8-3.6 8-8V560c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v144c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V384c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v320c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V462c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v242c0 4.4 3.6 8 8 8zm152 0h56c4.4 0 8-3.6 8-8V304c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v400c0 4.4 3.6 8 8 8z"></path></svg></span><span class="ant-menu-title-content">数据分析</span></li><li class="ant-menu-overflow-item ant-menu-item" style="opacity: 1; order: 4;" role="menuitem" tabindex="-1" aria-describedby="_R_1bcpb_" data-menu-id="rc-menu-uuid-71760-1-/attendance"><span role="img" aria-label="calendar" class="anticon anticon-calendar ant-menu-item-icon"><svg viewBox="64 64 896 896" focusable="false" data-icon="calendar" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M880 184H712v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H384v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H144c-17.7 0-32 14.3-32 32v664c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V216c0-17.7-14.3-32-32-32zm-40 656H184V460h656v380zM184 392V256h128v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h256v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h128v136H184z"></path></svg></span><span class="ant-menu-title-content">出战统计</span></li><li class="ant-menu-overflow-item ant-menu-item" style="opacity: 1; order: 5;" role="menuitem" tabindex="-1" aria-describedby="_R_1jcpb_" data-menu-id="rc-menu-uuid-71760-1-/registration"><span role="img" aria-label="form" class="anticon anticon-form ant-menu-item-icon"><svg viewBox="64 64 896 896" focusable="false" data-icon="form" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 512h-56c-4.4 0-8 3.6-8 8v320H184V184h320c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V520c0-4.4-3.6-8-8-8z"></path><path d="M355.9 534.9L354 653.8c-.1 8.9 7.1 16.2 16 16.2h.4l118-2.9c2-.1 4-.9 5.4-2.3l415.9-415c3.1-3.1 3.1-8.2 0-11.3L785.4 114.3c-1.6-1.6-3.6-2.3-5.7-2.3s-4.1.8-5.7 2.3l-415.8 415a8.3 8.3 0 00-2.3 5.6zm63.5 23.6L779.7 199l45.2 45.1-360.5 359.7-45.7 1.1.7-46.4z"></path></svg></span><span class="ant-menu-title-content">报名排表</span></li><li class="ant-menu-overflow-item ant-menu-overflow-item-rest ant-menu-submenu ant-menu-submenu-horizontal ant-menu-submenu-disabled" style="opacity: 0; order: 2147483647; height: 0px; overflow-y: hidden; pointer-events: none; position: absolute;" role="none" aria-hidden="true"><div role="menuitem" class="ant-menu-submenu-title" aria-expanded="false" aria-haspopup="true" data-menu-id="rc-menu-uuid-71760-1-rc-menu-more" aria-controls="rc-menu-uuid-71760-1-rc-menu-more-popup" aria-disabled="true"><span role="img" aria-label="ellipsis" class="anticon anticon-ellipsis"><svg viewBox="64 64 896 896" focusable="false" data-icon="ellipsis" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M176 511a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0z"></path></svg></span><i class="ant-menu-submenu-arrow"></i></div></li></ul><div style="display:none" aria-hidden="true"></div><div style="margin-left:auto"><div class="ant-space css-1vjf2v5 ant-space-horizontal ant-space-align-center ant-space-gap-row-small ant-space-gap-col-small"><div class="ant-space-item"><button type="button" class="ant-btn css-1vjf2v5 ant-btn-text ant-btn-color-default ant-btn-variant-text" style="color:white"><span class="ant-btn-icon"><span role="img" aria-label="login" class="anticon anticon-login"><svg viewBox="64 64 896 896" focusable="false" data-icon="login" width="1em" height="1em" fill="currentColor" aria-hidden="true"><defs><style></style></defs><path d="M521.7 82c-152.5-.4-286.7 78.5-363.4 197.7-3.4 5.3.4 12.3 6.7 12.3h70.3c4.8 0 9.3-2.1 12.3-5.8 7-8.5 14.5-16.7 22.4-24.5 32.6-32.5 70.5-58.1 112.7-75.9 43.6-18.4 90-27.8 137.9-27.8 47.9 0 94.3 9.3 137.9 27.8 42.2 17.8 80.1 43.4 112.7 75.9 32.6 32.5 58.1 70.4 76 112.5C865.7 417.8 875 464.1 875 512c0 47.9-9.4 94.2-27.8 137.8-17.8 42.1-43.4 80-76 112.5s-70.5 58.1-112.7 75.9A352.8 352.8 0 01520.6 866c-47.9 0-94.3-9.4-137.9-27.8A353.84 353.84 0 01270 762.3c-7.9-7.9-15.3-16.1-22.4-24.5-3-3.7-7.6-5.8-12.3-5.8H165c-6.3 0-10.2 7-6.7 12.3C234.9 863.2 368.5 942 520.6 942c236.2 0 428-190.1 430.4-425.6C953.4 277.1 761.3 82.6 521.7 82zM395.02 624v-76h-314c-4.4 0-8-3.6-8-8v-56c0-4.4 3.6-8 8-8h314v-76c0-6.7 7.8-10.5 13-6.3l141.9 112a8 8 0 010 12.6l-141.9 112c-5.2 4.1-13 .4-13-6.3z"></path></svg></span></span><span>登录</span></button></div><div class="ant-space-item"><button type="button" class="ant-btn css-1vjf2v5 ant-btn-primary ant-btn-color-primary ant-btn-variant-solid ant-btn-sm"><span>注 册</span></button></div></div></div></header>
<body>
    <h1>你好</h1>
    <div style="background: rgba(255,255,255,0.1); padding: 10px; color: white; text-align: right;">
    <span>目前登入：<strong id="user-display">載入中...</strong></span>
    <button onclick="handleLogout()" style="margin-left: 10px; padding: 5px 15px; border-radius: 15px; cursor: pointer; background: #ff4b2b; color: white; border: none;">
        登出
    </button>
</div>
</body>

<script>
    // 1. 初始化 (請確保 SB_KEY 是完整長度的那個)
    const SB_URL = 'https://ofuxzhfeqvihcgiucopx.supabase.co';
    const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9mdXh6aGZlcXZpaGNnaXVjb3B4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc0NjQ4ODEsImV4cCI6MjA4MzA0MDg4MX0.pYDTBag5NgmUFxOzABWIytnMtUv-QloY31JYZaoZrmk-n';
    const _supabase = supabase.createClient(SB_URL, SB_KEY);

    // 2. 判定登入狀態的主函數
    async function checkLoginStatus() {
        // 先檢查 LocalStorage 做初步判斷 (速度快)
        const isLoggedIn = localStorage.getItem('isLoggedIn');
        
        // 向 Supabase 伺服器確認 Session 是否真的有效
        const { data: { session }, error } = await _supabase.auth.getSession();

        if (!isLoggedIn || !session) {
            // 如果沒登入或 Session 過期，踢回登入頁
            console.log("未登入，跳轉中...");
            window.location.href = "auth.html";
        } else {
            // 登入成功，可以取得使用者資訊
            const userEmail = session.user.email;
            const username = userEmail.split('@')[0]; // 把 @gmail.com 削掉
            
            console.log("歡迎回來:", username);
            
            // 如果你有個 ID 叫 'user-display' 的元素，可以顯示名字
            if(document.getElementById('user-display')) {
                document.getElementById('user-display').textContent = username;
            }
        }
    }

    // 3. 登出函數
    async function handleLogout() {
        await _supabase.auth.signOut();
        localStorage.removeItem('isLoggedIn');
        window.location.href = "auth.html";
    }

    // 執行檢查
    checkLoginStatus();
</script>
